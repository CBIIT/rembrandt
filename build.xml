<project name="rembrandt" default="build_war" basedir=".">
	<property file="build.properties" />
	<!--
	TARGET: COMPILE
		Compiles the source directory
	-->
	<target name="compile" depends="config_database">
		<delete dir="${build.classes.dir}"/>
		<mkdir dir="${build.classes.dir}" />
		<javac srcdir="${source.dir}" destdir="${build.classes.dir}" source="1.4" excludes="**/test/**" debug="true" debuglevel="lines,vars,source">
		 <classpath>
		 	 <fileset dir="${source.lib.dir}">
	 	        <include name="*.jar"/>
	 	      </fileset>
	 	      <fileset dir="${source.nondeploy.lib.dir}">
	 	        <include name="*.jar"/>
	 	      </fileset>
		 </classpath>
		</javac>
	</target>
	<!--
	TARGET:  config_database
	Creates the correct database settings for the application. Properties are taken
	from the build.properties file.
	Properties Used:
		databaseUser-Specifies the database user
		urlDbalias - The URL to the database that we are going to use
		databasePassword - The database password
	-->
	<target name="config_database" depends="config_logging, config_analysis_server">
				<delete file="src/repository_database.xml"/>
			    <copy file="src/repository_database.xml.template" tofile="src/repository_database.xml"/>
				<replaceregexp file = "src/repository_database.xml" match="__DB_USER__" replace="${databaseUser}" flags="g"/>
				<replaceregexp file = "src/repository_database.xml" match="__URL_DB_ALIAS__" replace="${urlDbalias}" flags="g"/>
				<replaceregexp file = "src/repository_database.xml" match="__DB_PASSWD__" replace="${databasePassword}" flags="g"/>
	</target>
	<!--
		TARGET: config_logging
		Configures the log4j.properties file using the settings in the 
		build.properties file
	-->
	<target name="config_logging">
				<delete file="src/log4j.properties"/>
			    <copy file="src/log4j.properties.template" tofile="src/log4j.properties"/>
				<replaceregexp file = "src/log4j.properties" match="@LOGDIR@" replace="${logging.dir}" flags="g"/>
	</target>
	<!--
		TARGET: config_analysis_server
		Configures the JMS.properties file using the settings in the 
		build.properties file
	-->
	<target name="config_analysis_server">
				<delete file="src/jms.properties"/>
			    <copy file="src/jms.properties.template" tofile="src/jms.properties"/>
				<replaceregexp file = "src/jms.properties" match="@JBOSS_URL@" replace="${jboss.url}" flags="g"/>
	</target>
	<!--
		TARGET: copy_resources
		Copies all the bundle resources to the WEB-INF/classes/ folder
	-->
	<target name="copy_resources" depends="compile">
		<copy todir="${build.classes.dir}">
			<fileset dir="${source.dir}">
				<include name="*.xml" />
				<include name="*.properties" />
				<include name="*.dtd" />
				<include name="*.xsd" />
			</fileset>
		</copy>
    </target>
	<!--
		TARGET: build_war
		This will build the war file
	-->
    <target name="build_war" depends="copy_resources">
		<delete file="${app.war.name}.war" />
		<war destfile="${app.war.name}.war" webxml="${webapp.dir}/WEB-INF/web.xml">
			<fileset file="${webapp.dir}/*.*" />
			<zipfileset dir="${webapp.dir}/css" prefix="css" />
			<zipfileset dir="${webapp.dir}/images" prefix="images" />
			<zipfileset dir="${webapp.dir}/js" prefix="js" />
			<zipfileset dir="${webapp.dir}/jsp" prefix="jsp" />
			<zipfileset dir="${webapp.dir}/log" prefix="log" />
			<zipfileset dir="${webapp.dir}/tutorials" prefix="tutorials" />
			<zipfileset dir="${webapp.dir}/XSL" prefix="XSL" />
			<webinf dir="${webapp.dir}/WEB-INF"/>
	   	</war>
	</target>
	
</project>